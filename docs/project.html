<!DOCTYPE html>
<html>

<Head>
    <title>Final Project</title>
    <link rel="stylesheet" type="text/css" href="../style.css" />

    <div id="header">
            
        <h1>『EP1001 DIGI FABLAB』</h1>

        <nav>
          <ul class="navlink">
              <li><a href="../index.html" >|Home|</a></li>
              <li><a href="../index.html#topic" >|Topics|</a></li>
              <li><a href="../index.html#project" >|Projects|</a></li>
            </ul>
      </nav>

    </div>

    

</Head>



<body>

    <div id="container">

       

        <div id="main">

            <h2><u>Final Project: Neopixel mood-screen</u></h2>
        </div>

        <div id="contents">

          <h3 ><u> Project Idea</u></h3>
<p>For my project, I decided to create a working replica of an item used by the character &quot;Rina Tennoji&quot; from the TV animated series &quot;Love Live Nijigasaki&quot;, which can not 
  only be used as a nice display item, but also a wearable prop for cosplaying.</p>
</p>
<p><img src="https://i.imgur.com/cwSEbyF.jpg" width=200px height=auto /></p>

<p>&nbsp;</p>
<h3 >Design Brief</h3>
<ul>
<li><strong>Project Title:</strong> <u>Neopixel mood-screen</u> (a.k.a Auto Emotion Convert Rina-chan Board)</li>


</ul>
<p><strong>Functions</strong>:</p>
<ul>
<li>A screen made out of NeoPixel LED&#39;s that can display emotions using pixel art.</li>
<li>To be controlled remotely using Bluetooth.</li>


</ul>
<h3 ><u>Research</u></h3>
<p>There are many people only who attempted to recreate the Rina board, and one that stood out the most is by a <a href='https://youtu.be/0yT_qYHqlOU'>Japanese user</a>.</p>
<p><img src="https://pbs.twimg.com/media/EQBJ3lXU8AIGv4f?format=jpg&name=small" width=300px height=auto /></p>
<p>In his design, the display is controlled by push buttons, and all parts are 3D-printed, what&#39;s more he documents his entire process from designing to fabrication and programming, hence I will be referencing his methods in order to create my own version, with some added features.</p>
<p>You can read his documentations <a href='https://qiita.com/hamahamabe/items/9216df345bb908eb5199'>here</a>, note it is all in Japanese.</p>
<p>Here are my project specifications:</p>
<p><u>Structure</u></p>
<ul>
<li>Head gear to comprise of 3D printed, laser cut and Mold and casted (using 3D CNC) parts.</li>

</ul>
<p><u>Electronics</u></p>
<ul>
<li>Screen to be made out of Neopixel LEDs, controlled via Bluetooth from an iPhone.</li>
<li>ATTINY1614 board to be used for the program.</li>
<li>Entire circuitry to be inside the main screen.</li>

</ul>
<p>Materials</p>
<figure><table>
<thead>
<tr><th style='text-align:left;' >Component</th><th style='text-align:left;' >Remarks</th><th>Quantity</th></tr></thead>
<tbody><tr><td style='text-align:left;' >ATTINY1614 echo board</td><td style='text-align:left;' >Own fabricated</td><td>1</td></tr><tr><td style='text-align:left;' >UPDI programmer</td><td style='text-align:left;' >Own fabricated</td><td>1</td></tr><tr><td style='text-align:left;' >NeoPixel LED strip</td><td style='text-align:left;' >WS2812B</td><td>138 LEDs</td></tr><tr><td style='text-align:left;' >Bluetooth module</td><td style='text-align:left;' >HM-BT05</td><td>1</td></tr><tr><td style='text-align:left;' >Lipo battery</td><td style='text-align:left;' >3.7V</td><td>1</td></tr><tr><td style='text-align:left;' >DC-DC boost Converter</td><td style='text-align:left;' >MT3608</td><td>1</td></tr></tbody>
</table></figure>
<h3 ><u>Design</u></h3>
<p>The entire project consists of 2 parts: the Pixel screen (where the electronics are) and the Head gear (aesthetics), in which are all designed in FUSION 360.</p>
<p>&nbsp;</p>
<p><u>Design sketches</u></p>
<p><img src="https://i.imgur.com/F5BKmHI.jpg" width=500px height=auto /></p>
<p>I Designed the frame and light panel as separate parts, where the panel will just rest at the bottom of the frame.</p>
<p>The Neopixel will be placed in series through the board. As there is a distance between each LED, I will have to bend the trip to squeeze them in.</p>
<p><img src="https://i.imgur.com/34ZLv6E.jpg" width=500px height=auto /></p>
<p>On google sheets I created a neopixel map. The numbers shows the LED number. In total 136 LEDs are used. This would make it easier to program patterns using array.</p>
<p><img src="https://i.imgur.com/QetkhIg.png" width=500px height=auto /></p>
<p>&nbsp;</p>
<p>To fit the other electronics in, I decided to place a panel above the Neopixel strips, where the controller and other components will be placed on top.</p>
<p><img src="https://i.imgur.com/gOziBNU.jpg" width=500px height=auto /></p>
<p>As for the design of the other parts, I have tons of image reference from the show and game.</p>
<p> It is difficult to explain in detail the process of designing the parts so I will go through what I had to consider during designing. Designing this took around a week of trial and error, and back and forth referencing multiple images from the TV show, game and official character figurines, as well as estimated measurements of my head.</p>

<p> Time skip to the final design! The colours will not be loyal to the original as this is made as a prototype.</p>
<p><img src="https://i.imgur.com/rS6BzhF.png" width=500px height=auto /><img src="https://i.imgur.com/5eYJb7C.png" width=500px height=auto /></p>
<p>&nbsp;</p>
<p><u>NeoPixel screen</u>
The Pixel screen is the first part I designed as it is the most important part in the project. It will house all the electronics. The screen can be split into 3 parts:</p>
<p>&nbsp;</p>
<p><img src="https://i.imgur.com/fWibUeC.png" width=500px height=auto /></p>
<p>&nbsp;</p>
<p>I started of with designing the light panel as I had a template to use. I simply created a sketch, uploaded a canvas and traced over it. The frame is to mostly cover up the wearers face, with only the forehead and chin slightly visible.</p>
<p><img src="https://i.imgur.com/cP3cETp.png" width=500px height=auto /></p>
<p>The light panel will be where the Neopixel will be taped onto. It must be thin enough such that light can pass through it, so I extruded it to 1mm thick with the edges at 2mm for a more secure frame.</p>
<p><img src="https://i.imgur.com/MfcZt86.png" width=500px height=auto /></p>
<p>The thickness of the frame heavily depends on how the electronics are placed inside it, hence It will be printed last once all the electronics are mounted onto the light panel. </p>
<p>In the design I split the frame into 2 different parts, but it can be printed as a whole.</p>
<p>The back is simply to cover up the electronics. Holes will be cut through to allow access to the switch and for the Bluetooth module to be exposed. I will use a laser cutter to cut this part out later.</p>
<p><img src="https://i.imgur.com/h9uwRQV.png" width=500px height=auto /></p>
<p>&nbsp;</p>
<p>It is not shown here, but I extrude cut 2 holes at the corners of the frame so I can use screws to secure the back to the frame.</p>
<p>&nbsp;</p>
<p><u>Head gear</u></p>
<p>The head gear is the second part I designed, and the most time consuming one.</p>
<p><img src="https://i.imgur.com/EWghSGm.png" width=500px height=auto /></p>
<p>The head gear is mostly 3D printed. It consists of the Left and Right sides and the Head band.
   Again the measurements are just throwing in random numbers in consideration of my head size until the proportions look close to the original. The only actual measurement I took was the distance from the back of my head to my nose, which came out around 18cm.
    I focused on the design and shape of the left side, then once Im satisfied with the final design I mirrored it to create the right side.</p>
<p><img src="https://i.imgur.com/uGY25Ps.png" width=500px height=auto /></p>
<p>The way it was designed was such that it consist of multiple parts. This would allow the printing time to be split into multiple parts, and also the ease of painting the individual parts in the events the filament used is not the correct colour.</p>
<p><img src="https://i.imgur.com/92x5EKD.png" width=500px height=auto /></p>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h3 >__<u>Fabrication</u></h3>
<p>Most of the headgear parts are simply 3D printed.  It is just a matter of patience and hoping the prints turn out fine....</p>
<p><u><strong>3D Printing</strong></u>
I printed the first few parts and I realised the parts do not fit perfectly</p>
<p><img src="https://i.imgur.com/GSMTkSZ.jpg" width=500px height=auto /></p>
<p>I ended up having to sand the parts down until it fits, which is a very tedious job.
Not wanting to reprint the head compartment and not wanting to spend more time sanding it down, I ended up cutting the loop to fit the piece in and you can see a huge gap from a nice fit.</p>
<p><img src="https://i.imgur.com/wGnV04Z.jpg" width=500px height=auto /></p>
<p>To solve this I ended up going back to the FUSION 360 design and adding clearance to all parts that are going to fit together by reducing the parts by 0.6mm.</p>
<p><img src="https://i.imgur.com/BxMxANd.png" width=500px height=auto /><img src="https://i.imgur.com/xCDjVBL.png" width=500px height=auto /></p>
<p> The following prints came out to fit; not a perfect fit but its better than sanding it to fit.</p>
<p><img src="https://i.imgur.com/x3RNUJt.jpg" width=500px height=auto /></p>
<p>At that time there was no black filament available, so I spray painted the parts black. I secured the headset onto the sides with screws.</p>
<p><img src="https://i.imgur.com/4lI04lJ.jpg" width=400px height=auto /> <img src="https://i.imgur.com/uTq13UE.jpg" width=500px height=auto /></p>
<p>The issue here (which I will leave it to the future me) is the difficulty of re-adjusting the headband with the screws being the other way round. As I ended up glueing the head compartments in the screw heads are now inaccessible. The only way to adjust it is to use pliers and unscrew them from the thread ends: not very effective but hey it works!</p>
<p><u><strong>Mold and Casting</strong></u></p>
<p>I used the CNC cutter to create a mold and then casted the flower part out of resin. You can see the whole process <a href='https://plsspeccify.github.io/EP1001/docs/moulds.html'>here</a>.</p>
<p>I had to make 2 casts for both sides of the piece.</p>
<p><img src="https://i.imgur.com/8karVTU.jpg" width=500px height=auto /><img src="https://i.imgur.com/vqazPlU.jpg" width=500px height=auto /></p>
<p><img src="https://i.imgur.com/5eRVWTE.jpg" width=500px height=auto /><img src="https://i.imgur.com/sQhyKNZ.jpg" width=300px height=auto /></p>
<p>The resin cast adds weight to the back of the headset, allowing it to balance when the light display is added. It fits nicely into the 3D printed dome.</p>
<p>The headset is complete!</p>
<p><img src="https://i.imgur.com/9usM8Jv.jpg" width=500px height=auto /></p>
<p>For the screen I had trouble printing the 1mm thick screen as big panels can easily be warped,usually you can solve this by forcing the layer onto the build plate with glue but printing it at a slower speed gave a pretty good result.</p>
<p><img src="https://i.imgur.com/9q31U7o.jpg" width=500px height=auto /></p>
<p>For the case I simply printed it blue.</p>
<p><img src="https://i.imgur.com/BVaFf7X.jpg" width=500px height=auto /></p>
<p>I used the laser cutter to cut out the back cover.</p>
<p><img src="https://i.imgur.com/IdKkNcG.jpg" width=500px height=auto /></p>
<p>&nbsp;</p>
<h3 >__<u>Electronics and programming</u></h3>
<p>For the controller I decided to use the  ATTINY1614. It has  16 KB In-system self-programmable Flash memory and 2 KB SRAM, which would be sufficient to control all 138 LEDs. (Note 1 Neopixel LED would require 3 bytes of RAM). You can view the pinouts here. </p>
<p><img src="https://raw.githubusercontent.com/SpenceKonde/megaTinyCore/master/megaavr/extras/ATtiny_x14.gif" width=600px height=auto /></p>
<p>You can read more about it via the <a href='http://academy.cba.mit.edu/classes/embedded_programming/t1614/ATtiny1614-DataSheet-DS40001995B.pdf'>Datasheet</a> or <a href='https://github.com/SpenceKonde/megaTinyCore/blob/master/megaavr/extras/ATtiny_x14.md'>SpenceKonde</a>.</p>
<p>Then I went ahead and designed the board.</p>
<p><img src="https://i.imgur.com/75wXMdS.png" width=600px height=auto /></p>
<p>In the circuit I included a built in button and LED and I pulled out pins 11,12,13.</p>
<p><img src="https://i.imgur.com/eWeHH6D.png" width=500px height=auto /></p>
<p>Following that, I generated the gcode with Mods, cut the board out with the Stepcraft CNC cutter and soldered the parts together.</p>
<p><img src="https://i.imgur.com/PNVryjg.jpg" width=300px height=auto /><img src="https://i.imgur.com/PLsXiRU.jpg" width=300px height=auto /></p>
<p>To program the Tiny 1614 I will need a UPDI.
For the Arduino to recognise the board, I had to install megaTinyCore by Spence Konde under board manager.</p>
<p>Next are the I/O devices.</p>
<p>The electronics comprises of an Input and Output device: Bluetooth module and the Neopixel strip. My idea of the program is having an app connected to the controller via Bluetooth. The app will contain multiple buttons where each button will display a pixel art pattern on the Neopixel.</p>
<p>I first tested the board on an Arduino UNO, then I will transfer it to the ATTINY1614 board.</p>
<p><u><strong>Output - Light Panel (Neopixels)</strong></u>
The light panel is the tedious way of creating a neopixel matrix. The printed panel came out really transparent, so I drew out how the neopixels will be arranged and placed the panel over it for reference.</p>
<p><img src="https://i.imgur.com/g7Rfmsu.jpg" width=500px height=auto /><img src="https://i.imgur.com/tiQefEu.jpg" width=500px height=auto /></p>
<p> Preparing the Neopixel strips I first cut them to the desired length. Unfortunately the neopixels I bought were abit too big than the intended design (the original called for WS2812B-2020 which are small enough you can probably fit more pixels in than required). Before pasting them on I first trim the sides smaller and bend the corners with a stick to prevent sharp folds or you may destroy the connection. I also drew arrows to indicate the connections.</p>
<p><img src="https://i.imgur.com/M3hst3Q.jpg" width=500px height=auto /><img src="https://i.imgur.com/yuXngSa.jpg" width=500px height=auto /></p>
<p>I then used double sided tape to stick the neopixels on. For every strip placed I tested it to ensure the connections are ok.</p>

<video width=500px height=auto controls>
  <source src="https://i.imgur.com/yzktxOw.mp4" type="video/mp4">
  The your browser DIED cus the video is too stronk for you browser!
</video>



<p>Half way into pasting the neopixels I realise if the panel is thin enough to be seen through, the neopixels can be seen taped on from the front. To solve this I ended up sticking a sheet of paper to hide them.</p>
<p><img src="https://i.imgur.com/CURYwXV.jpg" width=500px height=auto /><img src="https://i.imgur.com/LzoWDa4.jpg" width=500px height=auto /></p>
<p>It ended up a very tight fit, managing to place all the neopixels in. After pasting all the pixels I soldered the connecting wires, labelling red for 5V, green for DATA and white for GND.</p>
<p><img src="https://i.imgur.com/zjuRPUp.jpg" width=500px height=auto /><img src="https://i.imgur.com/sxwtLjS.jpg" width=500px height=auto /></p>
<p>The Panel nicely fits into the frame. 
From the initial design I intended to cut a panel is separate the Neopixels from the other electronics, but that may make it more bulky so I simply insulted the LEDs by covering it with tape.</p>
<p><img src="https://i.imgur.com/GykBhpA.jpg" width=500px height=auto /></p>
<p>The WS2812B Neopixel strip consists of 3 pinouts: VCC, GND and DATA.</p>
<p><img src="https://cdn-learn.adafruit.com/assets/assets/000/030/892/medium800/leds_Wiring-Diagram.png?1456961114" width=500px height=auto /></p>
<p>The Neopixel only requires 5V, which means I can simply connect it straight to the controller. The DATA is connected to the output pins, which will control the LED turning on/off and its colour.</p>
<p><strong>How patterns are displayed</strong>
Back to the LED map I made, each LED is numbered from 0-137. In total 136 LEDs are used.</p>
<p>First is to declare the Pinouts:</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #557799">#include &lt;Adafruit_NeoPixel.h&gt;</span>
  <span style="color: #557799">#define PIN   6 </span><span style="color: #888888">// pin connected to the NeoPixels</span>
  <span style="color: #557799">#define NUMPIXELS      136 </span><span style="color: #888888">// no. of led</span>
  Adafruit_NeoPixel pixels <span style="color: #333333">=</span> Adafruit_NeoPixel(NUMPIXELS, PIN, NEO_GRB <span style="color: #333333">+</span> NEO_KHZ800);
  </pre></div>
  
<p>So DATA will be connected to pin 6 of the Arduino.</p>
<p>For each pattern only certain LEDs will be turned on. This can be combined to form an array:</p>
<p><img src="https://i.imgur.com/hyTp7f6.png" width=500px height=auto /></p>
<p>So to Display the pattern &quot;Smile&quot;, we can set an array like this:</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">const</span> PROGMEM <span style="color: #333399; font-weight: bold">uint8_t</span> smile[] <span style="color: #333333">=</span> { <span style="color: #888888">// smile pattern</span>
  <span style="color: #0000DD; font-weight: bold">4</span>,<span style="color: #0000DD; font-weight: bold">5</span>,<span style="color: #0000DD; font-weight: bold">16</span>,<span style="color: #0000DD; font-weight: bold">13</span>,<span style="color: #0000DD; font-weight: bold">22</span>,<span style="color: #0000DD; font-weight: bold">27</span>,<span style="color: #0000DD; font-weight: bold">38</span>,<span style="color: #0000DD; font-weight: bold">31</span>,<span style="color: #0000DD; font-weight: bold">41</span>,<span style="color: #0000DD; font-weight: bold">42</span>,<span style="color: #0000DD; font-weight: bold">43</span>,<span style="color: #0000DD; font-weight: bold">44</span>,<span style="color: #0000DD; font-weight: bold">45</span>,<span style="color: #0000DD; font-weight: bold">46</span>,<span style="color: #0000DD; font-weight: bold">47</span>,<span style="color: #0000DD; font-weight: bold">48</span>,<span style="color: #0000DD; font-weight: bold">68</span>,<span style="color: #0000DD; font-weight: bold">70</span>,<span style="color: #0000DD; font-weight: bold">75</span>,<span style="color: #0000DD; font-weight: bold">77</span>,<span style="color: #0000DD; font-weight: bold">88</span>,<span style="color: #0000DD; font-weight: bold">89</span>,<span style="color: #0000DD; font-weight: bold">96</span>,<span style="color: #0000DD; font-weight: bold">97</span>,<span style="color: #0000DD; font-weight: bold">105</span>,<span style="color: #0000DD; font-weight: bold">104</span>,<span style="color: #0000DD; font-weight: bold">101</span>,<span style="color: #0000DD; font-weight: bold">100</span>,<span style="color: #0000DD; font-weight: bold">112</span>,<span style="color: #0000DD; font-weight: bold">113</span>,<span style="color: #0000DD; font-weight: bold">125</span>,<span style="color: #0000DD; font-weight: bold">124</span>,<span style="color: #0000DD; font-weight: bold">121</span>,<span style="color: #0000DD; font-weight: bold">120</span>,<span style="color: #0000DD; font-weight: bold">128</span>,<span style="color: #0000DD; font-weight: bold">129</span>,<span style="color: #0000DD; font-weight: bold">136</span>,<span style="color: #0000DD; font-weight: bold">137</span>
}; <span style="color: #888888">//LEDs to turn on</span>
<span style="color: #333399; font-weight: bold">int</span> patternsmile <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">sizeof</span>(smile); <span style="color: #888888">//No. of LEDs</span>
</pre></div>

<p> <em>smile[]</em> consists an array of which LEDs to turn on, and <em>patternsmile</em> consists of the number of LEDs used to display the pattern.</p>
<p>Next is to setup the Neopixels. This code is to be placed in void setup:</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"> pixels.begin(); <span style="color: #888888">// This initializes the NeoPixel library.</span>
  <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;i<span style="color: #333333">&lt;</span>NUMPIXELS;i<span style="color: #333333">++</span>){pixels.setPixelColor(i, pixels.Color(<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>));} <span style="color: #888888">//set to off</span>
   pixels.show();
</pre></div>

<p>Setting the colours to (0,0,0) makes the LED turn off. The colours are set by (RED,GREEN,BLUE). so (255,0,0) would turn the LED red, while making all the Values 255 will make the LED white. (255,20,147) will make LEDs pink. If you want a specific colour you can just google &quot; (your colour) html RGB code&quot;.
Now to put the array to use and make the LEDs display:</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;i<span style="color: #333333">&lt;</span>NUMPIXELS;i<span style="color: #333333">++</span>){pixels.setPixelColor(i, pixels.Color(<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>));} <span style="color: #888888">//set to off</span>
    
  <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> point <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; point <span style="color: #333333">&lt;</span> patternsmile; point<span style="color: #333333">++</span>) { <span style="color: #888888">// read out the pattern</span>
  led <span style="color: #333333">=</span> pgm_read_byte_near(<span style="color: #333333">&amp;</span>smile[point]);
  pixels.setPixelColor(led, pixels.Color(<span style="color: #0000DD; font-weight: bold">255</span>,<span style="color: #0000DD; font-weight: bold">20</span>,<span style="color: #0000DD; font-weight: bold">147</span>));} <span style="color: #888888">// increment next point in pattern</span>
  pixels.show(); <span style="color: #888888">//display pattern</span>
  </pre></div>
  
<p>We first turn off all LEDs by setting the colours to (0,0,0). Then the for loop will go through the <em>smile</em> array and set the LED assigned numbers to On. Then it will display the pixels.</p>
<p>To control the display I assigned a variable to each display and use if statements.</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">if</span> (count <span style="color: #333333">==</span><span style="color: #0000DD; font-weight: bold">0</span>){
	<span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;i<span style="color: #333333">&lt;</span>NUMPIXELS;i<span style="color: #333333">++</span>){pixels.setPixelColor(i, pixels.Color(<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>));} <span style="color: #888888">//set to off</span>
  }
  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> (count <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">1</span>){ <span style="color: #888888">//smile</span>
	<span style="color: #888888">//display neopixel smile</span>
  }
  
  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> (count <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">2</span>){ <span style="color: #888888">//evil</span>
    <span style="color: #888888">//display neopixel evil</span>
     pixels.show();
  }

    <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> (count <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">3</span>){ <span style="color: #888888">//cry1</span>
    <span style="color: #888888">//display neopixel cry1</span>
  }
  <span style="color: #008800; font-weight: bold">else</span>{
    count <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span> ; <span style="color: #888888">// count reset to 0</span>
  }
</pre></div>

<p>If a button is used to increase the number is pressed, if the button is pressed 2 times, it will display the &quot;evil&quot; pattern, above 3 and counts will reset to 0.</p>
<p>When trying to upload the program, the compiled failed. For the Neopixels to run, Clock must be set to 16MHz Internal. After that it uploads properly.</p>
<p><img src="https://i.imgur.com/vnieNaL.png" width=500px height=auto /></p>
<p>Plugging it to the Arduino to test the pixels, they aren&#39;t line up perfectly but at least the program and connections work!</p>
<p><img src="https://i.imgur.com/evcHiqB.jpg" width=500px height=auto /><img src="https://i.imgur.com/FpiIDVF.jpg" width=300px height=auto /></p>
<p><u> Blink animation</u>
Usually when making light animations, you would display the first frame, use delay() then display the next frame, unfortunately that would break the if statemen. For this I used millis(), which returns the number of milliseconds passed since the Arduino board began running the current program.</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #333399; font-weight: bold">unsigned</span> <span style="color: #333399; font-weight: bold">long</span> ms;        <span style="color: #888888">//time from millis()</span>
  <span style="color: #333399; font-weight: bold">unsigned</span> <span style="color: #333399; font-weight: bold">long</span> msLast;    <span style="color: #888888">//last time the LED changed state</span>
  boolean blinkState <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;        <span style="color: #888888">//current LED state</span>
  <span style="color: #557799">#define LED_ON 5000</span>
  <span style="color: #557799">#define LED_OFF 200         </span><span style="color: #888888">// interval at which to blink (milliseconds)</span>
  
  <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">loop</span>(){
    ms <span style="color: #333333">=</span> millis();
        <span style="color: #008800; font-weight: bold">if</span> (ms <span style="color: #333333">-</span> msLast <span style="color: #333333">&gt;</span> (blinkState <span style="color: #333333">?</span> LED_ON <span style="color: #333333">:</span> LED_OFF)) {
             <span style="color: #333399; font-weight: bold">int</span> led <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;
          <span style="color: #008800; font-weight: bold">if</span> (blinkState <span style="color: #333333">==</span> LOW) {
         <span style="color: #333399; font-weight: bold">int</span> led <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>;
              
      <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;i<span style="color: #333333">&lt;</span>NUMPIXELS;i<span style="color: #333333">++</span>){pixels.setPixelColor(i, pixels.Color(<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>));} <span style="color: #888888">//set to off</span>
      <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> point <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; point <span style="color: #333333">&lt;</span> patternnormal; point<span style="color: #333333">++</span>) { <span style="color: #888888">// read out the pattern</span>
     led <span style="color: #333333">=</span> pgm_read_byte_near(<span style="color: #333333">&amp;</span>normal[point]);
      pixels.setPixelColor(led, pixels.Color(<span style="color: #0000DD; font-weight: bold">255</span>,<span style="color: #0000DD; font-weight: bold">20</span>,<span style="color: #0000DD; font-weight: bold">147</span>));}
      <span style="color: #888888">// increment next point in pattern</span>
        blinkState <span style="color: #333333">=</span> HIGH;
      } <span style="color: #008800; font-weight: bold">else</span> {
              
        <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;i<span style="color: #333333">&lt;</span>NUMPIXELS;i<span style="color: #333333">++</span>){pixels.setPixelColor(i, pixels.Color(<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">0</span>));} <span style="color: #888888">//set to off</span>
      <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> point <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; point <span style="color: #333333">&lt;</span> patternblink; point<span style="color: #333333">++</span>) { <span style="color: #888888">// read out the pattern</span>
     led <span style="color: #333333">=</span> pgm_read_byte_near(<span style="color: #333333">&amp;</span>blink[point]);
      pixels.setPixelColor(led, pixels.Color(<span style="color: #0000DD; font-weight: bold">255</span>,<span style="color: #0000DD; font-weight: bold">20</span>,<span style="color: #0000DD; font-weight: bold">147</span>));}
        blinkState <span style="color: #333333">=</span> LOW;
      }
      pixels.show();
          msLast <span style="color: #333333">=</span> ms;
      }
  
  }
  </pre></div>
  
<p>This creates the blinking animation.</p>
<video width=500px height=auto controls>
  <source src="https://i.imgur.com/rZtA5g3.mp4" type="video/mp4">
  The your browser DIED cus the video is too stronk for you browser!
</video>
<p><u>Input: Bluetooth Module</u></p>
<p>I used the HM-BT05 Module as it can be recognised by an Iphone. The module requires 4 pins: VCC, GND, TX and RX.</p>
<p><img src="https://www.electroschematics.com/wp-content/uploads/2017/10/2-Hardware-LED-Test.jpg?fit=730%2C400" width=500px height=auto /></p>
<p>The RX pin requires 3.3V, so a voltage divider is used to bring the voltage down.</p>
<p><u>Bluetooth control with Iphone</u></p>
<p>There are multiple apps that can let you communicate with Arduino Bluetooth modules. Two apps I would reccomend:</p>
<p> <a href='https://apps.apple.com/us/app/elegoo-ble-tool/id1441940983'>ELEGOO BLE TOOL</a></p>
<ul>
<li><p>Its interface is made for Arduino bluetooth robot cars, but one of the useful features is setting control buttons. With a push of a button you can send can characters or messages to the module in Text or Hexadecimal. You can name the buttons as well.</p>
<p><img src="https://i.imgur.com/OW31lfY.png" width=500px height=auto /><img src="https://i.imgur.com/mur2lHg.png" width=500px height=auto /></p>
</li>

</ul>
<p> <a href='https://apps.apple.com/us/app/bitblue/id1403675953'>BitBlue</a></p>
<ul>
<li>Has multiple interfaces, most useful is Terminal mode if you want to send messages to the module.<BR>
<img src="https://i.imgur.com/8HLzRJo.png" width=300px height=auto /></li>

</ul>
<p><u>Bluetooth Program</u></p>
<p>Here is a simple program to control an LED light, taken from <a href='https://makersportal.com/blog/2019/10/14/bluetooth-module-with-arduino'>Makers portal</a>.</p>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #557799">#include &lt;SoftwareSerial.h&gt;</span>
  <span style="color: #557799">#define LED 4</span>
  SoftwareSerial <span style="color: #0066BB; font-weight: bold">BT05</span>(<span style="color: #0000DD; font-weight: bold">3</span>, <span style="color: #0000DD; font-weight: bold">4</span>); <span style="color: #888888">// TX,RX</span>
  <span style="color: #333399; font-weight: bold">char</span> appData;  
  String inData <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;&quot;</span>;
  <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setup</span>()
  {
    Serial.begin(<span style="color: #0000DD; font-weight: bold">115200</span>);
    Serial.println(<span style="background-color: #fff0f0">&quot;BT05 serial started at 9600&quot;</span>);
    BT05.begin(<span style="color: #0000DD; font-weight: bold">9600</span>); <span style="color: #888888">// set HM10 serial at 9600 baud rate</span>
    pinMode(LED, OUTPUT); <span style="color: #888888">// onboard LED</span>
    digitalWrite(LED, LOW); <span style="color: #888888">// switch OFF LED</span>
  
  }
  
  <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">loop</span>()
  {
  
     BT05.listen();  <span style="color: #888888">// listen the HM10 port</span>
    <span style="color: #008800; font-weight: bold">while</span> (BT05.available() <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>) {   <span style="color: #888888">// if HM10 sends something then read</span>
      appData <span style="color: #333333">=</span> BT05.read();
      inData <span style="color: #333333">=</span> String(appData);  <span style="color: #888888">// save the data in string format</span>
      Serial.write(appData);
    }
  
    <span style="color: #008800; font-weight: bold">if</span> ( inData <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;F&quot;</span>) {
      Serial.println(<span style="background-color: #fff0f0">&quot;LED OFF&quot;</span>);
      digitalWrite(LED, LOW); <span style="color: #888888">// switch OFF LED</span>
      delay(<span style="color: #0000DD; font-weight: bold">500</span>);
    }
    <span style="color: #008800; font-weight: bold">if</span> ( inData <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;N&quot;</span>) {
      Serial.println(<span style="background-color: #fff0f0">&quot;LED ON&quot;</span>);
      digitalWrite(LED, HIGH); <span style="color: #888888">// switch OFF LED</span>
      delay(<span style="color: #0000DD; font-weight: bold">500</span>);
      digitalWrite(LED, LOW); <span style="color: #888888">// switch OFF LED</span>
      delay(<span style="color: #0000DD; font-weight: bold">500</span>);
    }
  }
  </pre></div>
  
<p>Here RX is connected to pin 4 through a voltage divider and TX to pin 3. LED is connected to pin 13.</p>
<p>The LED control works by reading the input. Sending &quot;F&quot; will turn the LED off while sending &quot;N&quot; Will cause the LED to blink. You can also view the Arduino serial com.</p>
<p>Using the ELEGOO app, I programmed the Off button to send &quot;F&quot; and the Blink button to send &quot;N&quot;.</p>
<video width=500px height=auto controls>
  <source src="https://i.imgur.com/1Ewa5JC.mp4" type="video/mp4">
  The your browser DIED cus the video is too stronk for you browser!
</video>

<p>&nbsp;</p>
<p><u>Integration</u></p>
<p>Combining the Bluetooth program and the Neopixel code, you can view the whole code <a href='https://plsspeccify.github.io/EP1001/docs/rina-blink.html' target=” ”>Here</a>.</p>
<video width=500px height=auto controls>
  <source src="https://i.imgur.com/Gw2dVSk.mp4" type="video/mp4">
  The your browser DIED cus the video is too stronk for you browser!
</video>
<p>Next is making the wires I followed the circuit diagram as shown below.</p>
<p><img src="https://i.imgur.com/iZzZHIL.png" width=500px height=auto /></p>
<p>I soldered the wires and resistors together and used shrink tubes to cover the bare wires.</p>
<p><img src="https://i.imgur.com/sMwR7DW.jpg" width=500px /></p>
<p>For the power source I used a 3.7V Lipo battery. As the circuit requires 5 volts I used the DC-DC boost converter to step up to 5V.</p>
<p><img src="https://i.imgur.com/F25WgiC.jpg" width=500px height=auto /></p>
<p>Then I wired everything else and secured the cover with screws.</p>
<p><img src="https://i.imgur.com/kMOQ2lN.jpg" width=500px height=auto /></p>
<p>With that the Neopixel board is done!  ＼(＾▽＾)／</p>
<p>&nbsp;</p>
<h3 ><u>Assembly</u></h3>
<p>The headgear and Neopixel screen are secured with screws.</p>
<p><img src="https://i.imgur.com/f3USBVH.jpg" width=500px height=auto /></p>
<p>Having a large hole to mount the frame to the headset was a design error, so I glued a washer in the hole and screwed it in place, then I used a hollow dome to cover the screw.</p>
<p><img src="https://i.imgur.com/6JQA1q7.jpg" width=500px height=auto /></p>

<h3 ><u>  Wearable</u></h3>
<p>For it to be used as a cosplay prop, it must be able to be worn (as see on TV). Prepare to see selfies wwww.</p>
<p>The main idea is to stick a pair of goggles at the back and attach a strap behind. As a quick prototype I used balsa wood planks and an old pair of safety goggles.</p>
<p>I tried to methods of attaching the goggles on. First method is attaching it to the back of the screen. This method allows the goggles to be hidden from the sides, however the screen cannot be adjustable. This prototype the wood I used was thick, adding extra weight to the whole mask, so when wearing it it prevents you from seeing and breathing.</p>
<p><img src="https://i.imgur.com/7UjnEGS.jpg" width=400px height=auto /><img src="https://i.imgur.com/8Oy3ufB.jpg" width=300px height=auto /></p>
<p>&nbsp;</p>
<img src="https://i.imgur.com/wSWAFq4.png" width=300px height=auto />
<p>&nbsp;</p>
<p>The second method I used thinner wood, this time instead of sticking it to the screen I wedge it between the headgear. This makes it possible to tilt the screen when being worn. However the wood is too large and you can see it from the front. I can modify this by using clear acrylic instead of wood, and reducing the size so it does not stick out of the mask. This one is easier to wear than the previous method.</p>
<p><img src="https://i.imgur.com/gkEsUIZ.jpg" width=400px height=auto />
<p>&nbsp;</p>
<img src="https://i.imgur.com/ZZZ8eYQ.jpg" width=300px height=auto />
<p>&nbsp;</p>


<h3 ><u>Documentation</u></h3>
<p><u>End product</u></p>
<p><img src="https://i.imgur.com/tJPG4Rs.jpg" width=500px height=auto /></p>
<p><u>Poster</u></p>
<img width=900px height=auto src="../img/Poster.png" >
<p><u>Video</u></p>
<iframe width="660" height="415" src="https://www.youtube.com/embed/w-IJBAgEARM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>In all, the final design is close to its original reference, although some changes can be made and there are multiple more things that must be solved in order to perfect it:</p>
<ul>
<li>Neopixel used can be smaller (preferably WS2812-2020), this can allow more unique images to be displayed.</li>
<li>Light panel design should be made of square grids instead of flat to give off the pixelated effect.</li>
<li>Finding a way to allow users to see the front when wearing the frame. One idea is to make the light panel translucent so the wearer will be able to see whats infront, or mount something like a VR headset at the back and put a camera infront (something like a drone VR headset).</li>
<li>Ease of wearing it. The screen can be quite heavy and when worn the goggles may pinch your nose, making you unable to see or breathe. The weight also makes the mask slide off your nose. Few ways to solve this is to reduce the weight of the entire mask (distribution the weight of the frame by spreading the electronics out instead of having it all in the screen). To prevent the mask from slipping we can replace the goggles strap with a stronger head strap. The methods above can be modified to make the goggles more hidden, other than that design changes to the headgear sides can be changed to make it more hidden.
</li>
</ul>

<p>Project files: <a href="../file/Rina Board_ EP1001_P1932795.zip" download files>Download</a></p>
<p>----------------------------------------END OF PROJECT----------------------------------------</p>


          
        </div>



        <div id="footer">
            Copyright &copy; Me (T_T), all rights reserved ~
        </div>

    </div>

    <button onclick="topFunction()" id="myBtn" title="Go to top">Back to Top</button>
    <script>
        mybutton = document.getElementById("myBtn");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0; // For Safari
  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}
    </script>


</body>



</html>